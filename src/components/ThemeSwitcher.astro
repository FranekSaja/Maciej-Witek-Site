---
import { Icon } from 'astro-icon/components';
---
<button id="theme-switcher" class="w-12 h-12 rounded-full flex items-center justify-center focus:outline-none transition-transform duration-200 hover:scale-110" style="cursor: pointer;">
  <div id="sun-icon">
    <Icon name="mdi:lightbulb-on-outline" size={40} />
  </div>
  <div id="moon-icon" class="hidden">
    <Icon name="mdi:weather-night" size={40} />
  </div>
</button>

<script>
  const switcher = document.getElementById('theme-switcher');
  const sunIcon = document.getElementById('sun-icon');
  const moonIcon = document.getElementById('moon-icon');
  const html = document.documentElement;

  const theme = (() => {
    if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
      return localStorage.getItem('theme');
    }
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark';
    }
    return 'light';
  })();

  if (sunIcon && moonIcon) {
    if (theme === 'light') {
      html.removeAttribute('data-theme');
      sunIcon.classList.add('hidden');
      moonIcon.classList.remove('hidden');
    } else {
      html.setAttribute('data-theme', 'dark');
      sunIcon.classList.remove('hidden');
      moonIcon.classList.add('hidden');
    }
  }

  if (switcher && sunIcon && moonIcon) {
    switcher.addEventListener('click', () => {
      const currentTheme = html.getAttribute('data-theme');
      if (currentTheme === 'dark') {
        html.removeAttribute('data-theme');
        localStorage.setItem('theme', 'light');
        sunIcon.classList.add('hidden');
        moonIcon.classList.remove('hidden');
      } else {
        html.setAttribute('data-theme', 'dark');
        localStorage.setItem('theme', 'dark');
        sunIcon.classList.remove('hidden');
        moonIcon.classList.add('hidden');
      }
    });
  }
</script>