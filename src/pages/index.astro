---
import MainLayout from "@layouts/MainLayout.astro";
import { getCollection } from "astro:content";
import CvButton from "@components/CvButton.astro";

const bio = await getCollection("bio");
const person = bio[0]?.data;
// Po zmianie kolekcji na type: 'content' wpisy mają metodę render().
// Niektóre edytory mogą jeszcze cache'ować typy — użyjemy bezpiecznego dostępu.
let BioContent: any = null;
if (bio[0]) {
  const entry: any = bio[0];
  if (typeof entry.render === 'function') {
    const rendered = await entry.render();
    BioContent = rendered.Content;
  }
}
---

<MainLayout title="Maciej Witek — Strona oficjalna" description="Sylwetka naukowa, obszary badawcze, publikacje i kontakt.">
  <section class="bio-container">
    <div class="bio-text">
      <header class="space-y-2">
        <h1 class="text-7xl font-bold tracking-tight">{person?.name ?? "Maciej Witek"}</h1>
        <p class="text-2xl">{person?.title ?? "Uniwersytet Szczeciński"}</p>
      </header>
      <article class="prose dark:prose-invert max-w-none">
        {BioContent ? <BioContent components={{ CvButton }} /> : <p>Uzupełnij sekcję bio w <code>src/content/bio/</code>.</p>}
      </article>
    </div>
    {person?.image && (
      <aside>
        <div class="image-wrapper">
          <img src={`${import.meta.env.BASE_URL}${person.image}`} alt={`Zdjęcie ${person.name}`} class="bio-image" />
        </div>
      </aside>
    )}
  </section>
</MainLayout>

<style>
  .bio-container {
    display: flex;
    flex-wrap: wrap;
    gap: 6rem;
    align-items: flex-start;
    justify-content: center;
    margin-top: 4rem;
  }

  @media (min-width: 992px) and (max-width: 1400px) {
    .bio-container {
      justify-content: space-between;
    }
  }

  @media (max-width: 992px) {
    .bio-container {
      flex-direction: column;
    }
  }
  .bio-text {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    flex: 2; /* Tekst zajmuje 2x więcej miejsca */
  }
  .bio-container aside {
    flex: 1; /* Zdjęcie zajmuje 1x miejsca */
    max-width: 500px; /* Ograniczenie maksymalnego rozmiaru zdjęcia */
  }
  .image-wrapper {
    padding: 16px; /* Grubość ramki */
    background: linear-gradient(to bottom, transparent 30%, white); /* Jeszcze więcej białego */
    border-radius: 50%;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin-inline: auto;
  }
  .bio-image {
    width: 100%;
    height: auto;
    border-radius: 50%;
    display: block;
  }

  @media (max-width: 768px) {
    h1 {
      font-size: 3rem; /* Tailwind's text-5xl */
      line-height: 1;
    }
    p {
      font-size: 1.25rem; /* Tailwind's text-xl */
    }
  }
</style>
