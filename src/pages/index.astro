---
import MainLayout from "@layouts/MainLayout.astro";
import { getCollection } from "astro:content";

const bio = await getCollection("bio");
const publications = await getCollection("publications");
const person = bio[0]?.data;
// Po zmianie kolekcji na type: 'content' wpisy mają metodę render().
// Niektóre edytory mogą jeszcze cache'ować typy — użyjemy bezpiecznego dostępu.
let BioContent: any = null;
if (bio[0]) {
  const entry: any = bio[0];
  if (typeof entry.render === 'function') {
    const rendered = await entry.render();
    BioContent = rendered.Content;
  }
}
---

<MainLayout title="Maciej Witek — Strona oficjalna" description="Sylwetka naukowa, obszary badawcze, publikacje i kontakt.">
  <section class="space-y-6">
    <header class="space-y-2">
      <h1 class="text-3xl font-bold tracking-tight">{person?.name ?? "Maciej Witek"}</h1>
      <p class="text-slate-600 dark:text-slate-300">{person?.title ?? "Uniwersytet Szczeciński"}</p>
    </header>

    <article class="prose dark:prose-invert max-w-none">
      {BioContent ? <BioContent /> : <p>Uzupełnij sekcję bio w <code>src/content/bio/</code>.</p>}
    </article>

    <section class="space-y-3">
      <h2 class="text-xl font-semibold">Wybrane publikacje</h2>
      {publications.length === 0 ? (
        <p>Brak publikacji.</p>
      ) : (
        <ul class="list-disc pl-5 space-y-1">
          {publications.sort((a,b) => (b.data.year ?? 0) - (a.data.year ?? 0)).slice(0,5).map((item) => (
            <li>
              <a href={item.data.link ?? '#'} class="underline decoration-slate-400 hover:decoration-slate-700">
                {item.data.title}
              </a>
              {item.data.year ? ` (${item.data.year})` : ''}
            </li>
          ))}
        </ul>
      )}
    </section>
  </section>
</MainLayout>
